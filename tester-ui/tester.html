<html>
<head>
<meta charset="utf-8">
<title>productws demo tester</title>
<style>textarea {width:500px;height:80px;}</style>
</head>

<body>
	<h1>productws demo tester</h1>
	<div id="content">
		Starting tester application...<br> If this text does not
		disappear, the React app does not start properly.
	</div>

		<script src="https://npmcdn.com/react@15.3.0/dist/react.js"></script>
		<script src="https://npmcdn.com/react-dom@15.3.0/dist/react-dom.js"></script>
		<script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- 	<script src="react.js"></script> -->
<!-- 	<script src="react-dom.js"></script> -->
<!-- 	<script src="browser.min.js"></script> -->
<!-- 	<script src="jquery.min.js"></script> -->

	<script type="text/babel">

function errorMsg(xhr, status, err) {
	return "ERROR: " + xhr.status + " " + err.toString() + "\n" + xhr.responseText
		+(xhr.readyState == 0 ? "\nService unavailable! Wrong URL?" : "");
}

var ServiceURL = React.createClass({
	render: function() {
		return <input id="serviceURLId" type="text" defaultValue="http://localhost:8081/" />;
	}
});

var CreateCall = React.createClass({
	getInitialState: function () {
		return { request: "{\"Name\":\"JSCO Mouse\",\"Desc\":\"Computer Optical Noiseless Mouse\",\"Prices\":{\"USD\":{\"Value\":2782,\"Multiplier\":100}}}"};
	},
	render: function() {
		return <div>
			Product JSON:<br/>
			<textarea value={this.state.request} onChange={this.onChange}></textarea><br/>
			<button onClick={this.handleClick}>CREATE</button> <code>"POST /create"</code><br/>
			Response:<br/>
			<textarea readOnly="true" value={this.state.response}></textarea>
		</div>;
	},
	onChange: function(event) {
		this.setState({request: event.target.value});
	},
	handleClick: function() {
		var t = this;
		$.ajax({
			url: document.getElementById("serviceURLId").value + "create",
			type: 'POST',
			data: t.state.request,
			dataType: 'json',
			success: function(data) {
				t.setState({response : JSON.stringify(data)});
			},
			error: function(xhr, status, err) {
				t.setState({response : errorMsg(xhr, status, err)});
			}
		});
	}
});

var ListCall = React.createClass({
	getInitialState: function () {
		return {};
	},
	render: function() {
		return <div>
			<button onClick={this.handleClick}>LIST</button> <code>"GET /list"</code><br/>
			Response:<br/>
			<textarea readOnly="true" value={this.state.response}></textarea>
		</div>;
	},
	handleClick: function() {
		var t = this;
		$.ajax({
			url: document.getElementById("serviceURLId").value + "list",
			success: function(data) {
				t.setState({response : JSON.stringify(data)});
			},
			error: function(xhr, status, err) {
				t.setState({response : errorMsg(xhr, status, err)});
			}
		});
	}
});

var DetailsCall = React.createClass({
	getInitialState: function () {
		return {id: ""};
	},
	render: function() {
		return <div>
			Product ID:<br/>
			<input type="text" value={this.state.id} onChange={this.onChange}></input><br/>
			<button onClick={this.handleClick}>DETAILS</button> <code>"GET /details/{this.state.id}"</code><br/>
			Response:<br/>
			<textarea readOnly="true" value={this.state.response}></textarea>
		</div>;
	},
	onChange: function(event) {
		this.setState({id: event.target.value});
	},
	handleClick: function() {
		var t = this;
		$.ajax({
			url: document.getElementById("serviceURLId").value + "details/" + t.state.id,
			success: function(data) {
				t.setState({response : JSON.stringify(data)});
			},
			error: function(xhr, status, err) {
				t.setState({response : errorMsg(xhr, status, err)});
			}
		});
	}
});

var TesterApp = React.createClass({
	render: function() {
		return <div>
			<div>Service URL: <ServiceURL /></div>
			<h3>Create a new product</h3>
			<CreateCall/>
			<h3>List all product IDs</h3>
			<ListCall/>
			<h3>Get details of a product</h3>
			<DetailsCall/>
		</div>;
	}
});

ReactDOM.render(
	<TesterApp />,
	document.getElementById('content')
);

</script>

</body>
</html>